# Chapter 6: 동영상 추천 시스템

> **6회차** | 6장 | Video Recommendation System

---

## 📖 핵심 내용 정리

### 1. 요구사항 명확화

- 비즈니스 목표는 무엇인지?
- 어떤 기능을 제공해야 하는지?
- 데이터셋의 규모와 라벨링은 어떻게 하는지?
- 시스템 규모나 제약은 어떻게 되는지?

| 항목 | 내용 |
|:---|:---|
| **비즈니스 목표** | 사용자의 참여도 증가 (참여도는 어떻게 정의할지?) |
| **제공 기능** | 새로고침 했을 때 피드에 사용자가 관심 있어 할 동영상을 띄워주는 것 |
| **데이터셋 규모** | 동영상 약 100억 개 |
| **라벨링** | 사용자 상호작용 기반으로 데이터셋 구성 |
| **속도** | 200ms 안에 추천 가능할 것 |

---

### 2. 머신러닝 작업으로 문제 구조화

- **머신러닝 목표** → 관련 동영상 수 극대화
- **입력 및 출력** → 사용자, 랭킹 동영상
- **머신러닝 방법론** → 순차적 하이브리드 필터링

#### 머신러닝 목표 - 참여율 어떻게 정의할건지?

| 목표 | 문제점 |
|:---|:---|
| **클릭 수** | 제목과 미리보기 이미지가 자극적인 낚시성 컨텐츠 위주로 추천하게 될 가능성이 있다 |
| **시청 완료 동영상 수 극대화** | 짧은 동영상만 추천하는 문제가 생길 수 있다 |
| **총시청 시간 극대화** | 더 많은 시간을 시청하도록 추천 영상 |
| **관련 동영상 수 극대화** | 어떤게 관련 동영상인가? → 좋아요 버튼을 누르거나 절반 이상 시청 시 관련 동영상으로 정의 |

> 해당 책에서는 **관련 동영상 수 극대화**를 목표로 정했다.

#### 입력 및 출력

- **입력**: 사용자 정보
- **출력**: 순위화 된 동영상

#### 머신러닝 방법론

| 방법론 | 설명 | 장점 | 단점 |
|:---|:---|:---|:---|
| **Content-based 필터링** | 아이템 프로필을 통해 사용자 프로필 생성 | 상호 작용 정보 없이 아이템 프로필 생성 가능, 사용자의 고유 취향 찾아줄 수 있음 | 취향에 대한 overfitting → 새로운 관심사 찾기 어려움. 아이템 피처를 정교하게 만들기 위한 도메인 지식 필요 |
| **Collaborative 필터링** | 아이템 정보 없이 아이템-사용자 상호작용을 이용해서 프로필 만듦 | overfitting 없이 새로운 관심사 찾아줄 수 있음. 도메인 지식이 필요 없음. 임베딩이 필요 없으므로 비교적 효율적 | cold start 문제 → 구매 이력이 있어야 하므로. 특이한 관심사에 대해 추천이 약해짐 ← 특이한 관심사를 가진 사람이 적으므로 |
| **하이브리드 필터링** | 협업 필터링과 컨텐츠 기반 필터링을 동시에 사용하는 것 | 병렬 하이브리드와 순차적 하이브리드가 있는데 대부분 **순차적 하이브리드** 사용함 | - |

---

### 3. 데이터 준비

- **데이터 엔지니어링** - 어떻게 테이블을 정의할 것인지?
- **피처 엔지니어링** - 모델에 어떻게 태울 것인지?

#### 데이터 엔지니어링

| 테이블 | 필드 |
|:---|:---|
| **사용자** | 나이, 성별, 언어, 나라 |
| **동영상** | ID, 태그, 제목, 좋아요, 조회수, 길이 |
| **사용자-동영상 상호작용** | 상호작용 유형 (클릭, 좋아요, 싫어요, 노출, 검색, 댓글) |

#### 피처 엔지니어링

##### 동영상 피처

| 피처 | 타입 | 변환 방법 | 비고 |
|:---|:---|:---|:---|
| **ID** | 범주형 | 임베딩 | 충분한 상호작용 데이터가 있으면 ID에 적절한 의미 부여 가능. 어떤 동영상의 경우 시스템이 노출을 거의 하지 않아 interaction이 거의 없는데 어떡하지? → 일정 비율을 보장해야하나? |
| **동영상 길이** | 수치형 | - | 짧은 동영상을 선호하는 사용자 존재 |
| **언어** | 범주형 | - | - |
| **제목 및 태그** | 텍스트 | 언어 임베딩 | - |

##### 사용자 피처

| 피처 | 변환 방법 |
|:---|:---|
| ID | 임베딩 |
| 나이 | 버킷 |
| 성별 | 원-핫 |
| 언어 | 임베딩 |
| 도시 | 임베딩 |
| 국가 | 임베딩 |

##### 컨텍스트 정보

| 피처 | 변환 방법 | 비고 |
|:---|:---|:---|
| **시간대** | 버킷 | 소프트웨어 개발자는 저녁 시간대에 교육 영상 볼 수도 있음 |
| **요일** | 원-핫 | - |
| **단말** | 원-핫 | - |

##### 상호작용 정보

| 피처 | 변환 방법 |
|:---|:---|
| 검색 기록 | 언어 모델 |
| 좋아요 누른 동영상 | 임베딩 모델 |
| 시청한 동영상 | 임베딩 모델 |

---

### 4. 모델 개발

모델 선택 및 학습 방법 선택

#### 행렬 인수분해

- **피드백 행렬 구성**: 명시적 피드백(좋아요, 공유) + 암시적 피드백(클릭 수) 조합

**Loss에 대해:**

| 방식 | 문제점 |
|:---|:---|
| 관찰된 것에 대해서만 MSE 적용 | 나머지 것들에 대해 점수 확인 안됨 |
| 관찰된 것 + 관찰되지 않은 것 MSE 적용 | 동등하게 적용할 시 거의 다 0점 주는게 최소 |
| **가중치(하이퍼 파라미터)를 줘서 관찰된 것 + 관찰되지 않은 것에 대한 MSE 적용** | 선택 |

**장점:**
- 학습할 행렬이 2개라 학습 속도가 빠르다
- 학습된 임베딩이 정적이므로 서빙 시 바로 재사용 가능하다

**단점:**
- 사용자와 동영상 상호작용에만 의존
- 신규 사용자의 경우 상호작용이 모이기 전에는 처리가 어렵다

#### 투-타워 신경망

- **라벨링**: 명시적으로 동영상에 좋아요 누른 경우, 절반 이상을 시청한 경우 positive 라벨
- **손실함수**: Cross-entropy

**장점:**
- 사용자 피처 활용
- 신규 사용자 처리 가능

**단점:**
- 서빙 속도 느림 (사용자 임베딩 계산)
- 훈련 비용 많이 소모

---

### 5. 평가

오프라인 평가와 온라인 평가를 어떻게 할 것인가?

#### 오프라인

| 지표 | 설명 |
|:---|:---|
| **Precision@k** | - |
| **다양성** | 평균 쌍별 유사도 (평균 쌍별 유사도가 낮은지) |

#### 온라인

- 클릭률
- 시청 완료 동영상 수
- 총시청 시간
- 명시적인 사용자 피드백 수

---

### 6. 서빙

```
후보 동영상 생성 → 랭킹 → 리랭커
```

| 단계 | 모델 | 설명 |
|:---|:---|:---|
| **후보 동영상 생성** | 투 타워 모델 + 기타 다른 후보 모델 | 다양성 확보. 후보를 빠르게 생성하기 위해 동영상 피처에 의존하지 않는 모델 |
| **랭킹** | 투 타워 모델 | 정확성을 우선시 하기 위해 동영상 피처에 의존하는 무거운 모델 |
| **리랭커** | - | 낚시성인지 여부와 유해한 동영상 판별하여 순위 재조정 |
