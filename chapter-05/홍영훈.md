# Chapter 5: 유해 콘텐츠 탐지

> **5회차** | 5장 | Harmful Content Detection

소셜 미디어 플랫폼에서 사용자에게 안전한 플랫폼을 만들기 위해 유해한 컨텐츠와 악의적인 행위자 식별하는 기술 필요

---

## 📖 핵심 내용 정리

### 1. 요구사항 명확화

> 💡 비즈니스 목표, 시스템이 제공하는 피처, 제약

#### 비즈니스 목표

- 안전한 플랫폼을 만들기

#### 범위 선정 (시스템의 범위를 구체화 하는 단계)

| 항목 | 내용 |
|:---|:---|
| **식별 대상** | 유해한 컨텐츠 (~~악의적인 행위자~~ - 집중을 위해 컨텐츠만 적용) |
| **구체적인 범주** | 폭력, 노출, 혐오 발언 (~~잘못된 정보~~) |

#### 데이터의 구성

| 항목 | 내용 |
|:---|:---|
| **컨텐츠 구성** | 텍스트 + 이미지 + 동영상 |
| **언어** | 다국어 지원 |
| **라벨링** | 매일 5억 개 이상의 게시물 중 10,000개 사람이 주석 |

#### 시스템이 제공해야 하는 피처

- 게시물을 삭제하는 이유를 설명할 것
  - 이러한 이유는 사용자가 향후 게시물을 가이드라인에 맞게 작성할 수 있게

#### 제약

- **지연 시간 요건**: 실시간 예측 vs 배치 예측
  - 유해 컨텐츠마다 다를 수 있음

---

### 2. 머신러닝 작업으로 문제를 구조화

> 💡 머신러닝 목표, 시스템 입출력, 머신러닝 유형

#### 머신러닝 목표

- 유해한 게시물을 정확하게 예측하는 것

#### 시스템 입출력

- **입력**: 게시물
- **출력**: 각 카테고리 별 유해함 확률 (vs ~~컨텐츠 유해 확률~~)
  - 왜? → 사용자에게 이유를 설명할 수 있게, 어떤 카테고리에서의 유해함인지 구분

#### 머신러닝 유형

**멀티모달** - 다양한 유형의 데이터를 받아야 함

##### Early fusion vs Late fusion

| 방식 | 설명 | 장점 | 단점 |
|:---|:---|:---|:---|
| **Late fusion** | 각 데이터 유형에 대해 유해함을 판별한 후 결과를 합치는 방법 | 각 모델을 독립적으로 개선 가능 | 개별 모델 학습 시 각 양식에 대한 별도의 학습 데이터 필요 → 시간과 비용. 개별적으론 무해할 수 있으나 조합이 유해할 수 있음 |
| **Early fusion** | 융합된 feature를 만들고 이후 추론하는 방식 | 훈련 데이터 별도 수집 X. 조합이 유해한 경우 포착 가능 | 모달 간 상호작용 학습을 위해 입력 차원 수가 크게 늘어나므로 이에 따라 파라미터도 증가하게 되어 더 많은 학습 데이터 필요 |

##### 유해 등급 당 하나의 이진 분류? 다중 라벨 분류? 다중 작업 분류?

| 방식 | 단점/장점 |
|:---|:---|
| **하나의 이진 분류** | 여러 모델을 동시에 학습, 배포 시켜야 하므로 GPU, 비용 문제. 유사한 feature에 대해 여러 모델이 비슷한 계산 |
| **다중 라벨 분류** | 모든 클래스를 동시에 예측할 때 각각의 클래스에 맞는 형식으로 피처를 구성하지 못함 |
| **다중 작업 분류** | **장점**: 단일 모델 활용하므로 훈련이나 유지 관리 쉬움. 공유 계층으로 인해 중복 계산 방지 (여러 모델에 비해). 각 작업의 학습 데이터로 공유 계층이 학습되므로 데이터 적은 클래스에서도 도움 |

---

### 3. 데이터 준비

> 💡 데이터 엔지니어링과 피처 엔지니어링을 어떻게 할 것인가?

#### 데이터 엔지니어링

| 테이블 | 필드 |
|:---|:---|
| **사용자** | 사용자 ID, 기타 사용자 정보, 위반 이력 |
| **게시물** | 게시물 ID, 이미지, 텍스트, 올린 사람 ID |
| **사용자와 게시물 간 상호작용** | 게시물 ID, 사용자 ID, 반응(좋아요, 싫어요), 신고 |

#### 피처 엔지니어링

##### 컨텐츠

| 피처 | 처리 방법 |
|:---|:---|
| **텍스트 컨텐츠** | 텍스트 전처리 및 벡터화 - BERT류 모델 활용 |
| **이미지 또는 동영상** | 전처리 및 피처 추출 |

##### 게시물에 대한 사용자 반응

컨텐츠가 모호한 경우 게시물이 유해한지 여부를 사용자 반응을 바탕으로 판단할 수 있음:
- 좋아요, 공유, 댓글 및 신고 수
- 댓글 (여러 댓글 임베딩 후 집계)

##### 작성자 피처

| 피처 | 설명 |
|:---|:---|
| **위반 이력** | 위반 횟수, 사용자 신고 총 수, 비속어 단어 비율 |
| **개인정보** | 작성자 개인정보 |
| **계정 정보** | 팔로워 및 팔로잉 수, 계정 나이 (최근에 만들어졌다면 스팸 계정일 확률 높음) |

##### 컨텍스트 정보

- 시간
- 단말

---

### 4. 모델 개발

> 💡 모델 선택 및 학습 방법 선택

#### 모델 훈련

##### 데이터 세트 구성

모델의 input feature와 라벨을 준비하는 단계:
- **모델 학습**: 자동 라벨링(사용자 신고)를 통해 만들어진 데이터 활용
- **평가셋**: 수동 라벨링

##### 손실 함수 선택

- 크로스 엔트로피

##### 예측되는 문제 - Overfitting

멀티모달 시스템의 경우 주로 발생:
- 예를 들어, 여러 모달리티에서 한 모달리티가 학습 과정의 대부분을 차지하는 경우
- **해결책**: Gradient blending이나 Focal loss 활용

---

### 5. 평가

> 💡 오프라인 평가와 온라인 평가

#### 오프라인 평가

- F1 score
- PR 곡선 + AUC
- ROC 곡선 + AUC

#### 온라인 평가

| 지표 | 계산 | 설명 |
|:---|:---|:---|
| **유행성(Prevalence)** | 차단하지 않은 유해 게시물 / 전체 게시물 | 돌아다니는 유해 게시물 비율. 조회 노출 수가 10인 게시물과 10억인 게시물이 동일하게 평가 됨 |
| **유효한 이의 제기 건수** | 유효한 이의 제기 건수 / 시스템 감지 건수 | 낮을수록 좋음 |
| **사전 예방 비율** | 시스템 감지 건수 / (시스템 감지 건수 + 사용자 신고 건수) | 높을수록 좋음. 높아지는 상황은 시스템 감지 건수와 사용자 신고 건수의 교집합이 큰 경우 |

---

### 6. 서빙

#### 파이프라인

- 애플리케이션에서 사용자가 할 수 있는 행동 = `upload_post`, `comment`
- 이에 맞춰서 `upload_post`할 때 유해 컨텐츠 감지 서비스

#### 유해 컨텐츠 감지 서비스

```
유해 컨텐츠 감지 서비스 → 1. 위반 단속 서비스
                      → 2. 강등 서비스
```

| 서비스 | 설명 |
|:---|:---|
| **위반 단속 서비스** | 높은 확률로 예측된 경우 즉시 삭제 후 사용자에게 이유 설명 |
| **강등 서비스** | 해당 게시물이 사용자 사이에서 확산할 가능성을 줄이기 위해 등급 내림. 이후 스토리지에 저장해서 수동으로 검토할 수 있게 함. 수동 검토 데이터는 학습 데이터로 활용 |
